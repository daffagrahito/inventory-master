{% extends 'base.html' %}

{% block content %}
    <nav class="navbar bg-dark border-bottom border-body" data-bs-theme="dark">
        <div class="container-fluid">
        <a class="navbar-brand">{{ app_name }}</a>
        <form class="d-flex" role="logout">
            <a href="{% url 'main:logout' %}">
                <button class="btn btn-outline-success" type="button">Logout</button>
            </a>
        </form>
        </div>
    </nav>

    <center>
    <div class="container mt-4">
        <h4>An inventory to manage inventories</h4>
        <hr>

        <p><b>Name:</b> {{ name }}</p>
        <p><b>Class:</b> {{ class }}</p>

        <hr>

        <p>Terdapat {{ total_items }} inventory yang telah dimasukkan</p>

        <div class="card main">
            <div class="card-body d-flex flex-wrap" id="item-list-container">
                <!-- Moved content in the JavaScript with AJAX -->
            </div>
        </div>        

        <div class="mt-3">
            <a href="{% url 'main:create_item' %}" class="btn new-item-button">
                Add New Item
            </a>
        </div>

        <!-- Modals for AJAX -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Add New Product</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="form" onsubmit="return false;">
                            {% csrf_token %}
                            <div class="mb-3">
                                <label for="name" class="col-form-label">Name:</label>
                                <input type="text" class="form-control" id="name" name="name"></input>
                            </div>
                            <div class="mb-3">
                                <label for="price" class="col-form-label">Amount:</label>
                                <input type="number" class="form-control" id="amount" name="amount"></input>
                            </div>
                            <div class="mb-3">
                                <label for="description" class="col-form-label">Description:</label>
                                <textarea class="form-control" id="description" name="description"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="name" class="col-form-label">Category:</label>
                                <input type="text" class="form-control" id="category" name="category"></input>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="button_add" data-bs-dismiss="modal">Add Item</button>
                    </div>
                </div>
            </div>
        </div>

        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">Add Item by AJAX</button>
        <p></p>
        <h5>Sesi terakhir login: {{ last_login }}</h5>
    </div>
    </center>

    <style>
    html, body {
        background: linear-gradient(to bottom right, white, #8f94fb); /* Ganti dengan warna latar belakang atau properti CSS lainnya yang diinginkan */
        background-attachment: scroll; /* Ini mencegah latar belakang menggulir */
        min-height: 100vh;
        margin: 0;
    }

    /* Atur warna tombol */
    .new-item-button {
        background-color: rgb(60, 60, 60);
        color: white;
    }   

    .main {
        max-width: 100%; /* Menggunakan lebar maksimum untuk tampilan desktop */
    }

    /* Mengatur tampilan samping-sampingan menggunakan Flexbox */
    .item-card {
        background: linear-gradient(to bottom right, white, #8f94fb); /* Ganti dengan warna latar belakang atau properti CSS lainnya yang diinginkan */
        flex: 0 0 calc(50% - 20px); /* 50% lebar, dengan margin sebesar 10px */
        margin: 10px;
    }

    .last-item-card {
        background: linear-gradient(to bottom right, #4e54c8, #8f94fb); /* Ganti dengan warna latar belakang atau properti CSS lainnya yang diinginkan */
        color: white; /* Ganti dengan warna teks yang sesuai */
    }
    </style>

<script>
    async function getItems() {
        return fetch("{% url 'main:get_item_json' %}").then((res) => res.json());
    }

    async function refreshItem() {
        const itemListContainer = document.getElementById("item-list-container");
        const items = await getItems();
        itemListContainer.innerHTML = "";

        items.forEach((item) => {
            // Create item card baru
            const itemCard = document.createElement("div");
            itemCard.className = "card mb-3 item-card";

            // Populate konten item card
            itemCard.innerHTML = `
                <div class="card-header">${item.fields.name}</div>
                <div class="card-body">
                    <p><b>Amount:</b> ${item.fields.amount}</p>
                    <p><b>Date Added:</b> ${item.fields.date_added}</p>
                    <p><b>Category:</b> ${item.fields.category}</p>
                    <div class="btn-group" role="group">
                        <a href="increase-amount/${item.pk}" class="btn btn-success btn-sm mx-1"> + </a>
                        <a href="decrease-amount/${item.pk}" class="btn btn-success btn-sm mx-1"> - </a>
                        <a href="delete-item/${item.pk}" class="btn btn-danger btn-sm mx-1"> Delete </a>
                        <a href="edit-item/${item.pk}" class="btn btn-primary btn-sm mx-1"> Edit </a>
                        <!-- Button to trigger the description modal -->
                        <button class="btn btn-info btn-sm mx-1" data-bs-toggle="modal" data-bs-target="#descriptionModal${item.pk}">
                            Show Description
                        </button>
                    </div>
                </div>
            `;

            // Append item card ke container
            itemListContainer.appendChild(itemCard);

            // Create modal
            const modal = document.createElement("div");
            modal.className = "modal fade";
            modal.id = `descriptionModal${item.pk}`;
            modal.tabIndex = -1;
            modal.setAttribute("aria-labelledby", `descriptionModalLabel${item.pk}`);
            modal.setAttribute("aria-hidden", "true");

            modal.innerHTML = `
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="descriptionModalLabel${item.pk}">Description</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            ${item.fields.description}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            `;

            // Append modal ke container
            itemListContainer.appendChild(modal);
        });
    }

    refreshItem();

    function addItem() {
        fetch("{% url 'main:create_ajax' %}", {
            method: "POST",
            body: new FormData(document.querySelector('#form'))
        }).then(refreshItem)

        document.getElementById("form").reset()
        return false
    }

    document.getElementById("button_add").onclick = addItem

        
</script>

{% endblock content %}
